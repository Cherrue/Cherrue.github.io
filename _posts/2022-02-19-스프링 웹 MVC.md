---
layout: single
title: \[ê°•ì˜ìš”ì•½\] ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš© - ìŠ¤í”„ë§ ì›¹ MVC (2/2)
date: 2022-02-19 17:22:00 +0900
categories: lecture_summary springboot springboot_getting_started
toc: true
toc_sticky: true
toc_label: Contents
show_in_home: false
---

ê°œì¸ì ì¸ í•™ìŠµì„ ìœ„í•œ [Inflearn - ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš©](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/dashboard)(ë°±ê¸°ì„ ) ê°•ì˜ ìš”ì•½ì…ë‹ˆë‹¤.

ê°œë…ê³¼ ì›ë¦¬ ìœ„ì£¼ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.

[ì´ì „ ê¸€](https://cherrue.github.io/lecture_summary/springboot/springboot_getting_started/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%ED%99%9C%EC%9A%A9-3/) ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.

# 4ë¶€. ìŠ¤í”„ë§ ë¶€íŠ¸ í™œìš©

---

## 13. Thymeleaf

ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±(springmvcdemo)

**13-1. í…œí”Œë¦¿ ì—”ì§„**

- ì£¼ë¡œ Viewë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©
- ì½”ë“œ ì œë„ˆë ˆì´ì…˜, email í…œí”Œë¦¿ ë“±ì— ì‚¬ìš© ê°€ëŠ¥

**13-2. ìŠ¤í”„ë§ë¶€íŠ¸ê°€ ìë™ ì„¤ì •ì„ ì§€ì›í•˜ëŠ” í…œí”Œë¦¿ ì—”ì§„**

- FreeMarker, Groovy, **Thymeleaf**, Mustache ë“±ì´ ìˆìŒ
- JspëŠ” ì§€ì›í•˜ì§€ ì•Šê³ , ê¶Œì¥í•˜ì§€ë„ ì•ŠìŒ
    
    > ë‚´ì¥ í†°ìº£ì„ í¬í•¨í•˜ëŠ” jarë¥¼ ì“°ë©´ jsp ì‚¬ìš©ì´ ë¶ˆê°€í•¨. <br/>
    í†°ìº£ì´ ë– ìˆëŠ” ì„œë²„ì—ì„œ java -jar ì‚¬ìš©ì´ í•„ìš” <br/>
    undertowì˜ ê²½ìš° jarë¥¼ í˜¸í™˜í•˜ì§€ë„ ì•ŠìŒ <br/>
    ì˜ì¡´ì„± ë¬¸ì œê¹Œì§€ ë°œìƒí•  ìˆ˜ ìˆìŒ
    > 

**13-3. thymeleaf ì‚¬ìš©í•˜ê¸°**

13-3-1. ì˜ì¡´ì„± ì¶”ê°€

```xml
// pom.xml
				<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
            <version>2.2.0.RELEASE</version>
        </dependency>
```

13-3-2. ìë™ ì„¤ì •ì´ íŒŒì¼ì„ ì°¾ëŠ” ìœ„ì¹˜ : /src/main/resources/templates/

13-3-3. í…ŒìŠ¤íŠ¸ ì¶”ê°€

```java
@RunWith(SpringRunner.class)
@WebMvcTest(SampleController.class)
public class SampleControllerTest {
    @Autowired
    MockMvc mockMvc;
    
    @Test
    public void hello() throws Exception {
        // ìš”ì²­ : "/hello"
        // ì‘ë‹µ
        // - ëª¨ë¸ name : cherrue
        // - ë·° ì´ë¦„ : hello
        mockMvc.perform(get("/hello"))
                .andExpect(status().isOk())
								.andDo(print())
                .andExpect(view().name("hello"))
                .andExpect(model().attribute("name", is("cherrue")));
    }
}
```

13-3-3. ì»¨íŠ¸ë¡¤ëŸ¬ ì¶”ê°€ (@restcontroller X)

ì‘ë‹µì˜ string ì€ ì‘ë‹µ ë³¸ë¬¸ì´ ì•„ë‹Œ ì‘ë‹µ íŒŒì¼ì˜ ì´ë¦„

model ì€ Map ì´ë¼ê³  ìƒê°í•˜ë©´ ì‰½ë‹¤.

```java
@Controller
public class SampleController {
    @GetMapping("/hello")
    public String hello(Model model) {
				model.addAttribute("name", "cherrue");
        return "hello";
    }
}
```

13-3-4. í…œí”Œë¦¿ ì¶”ê°€(main/resources/templates/hello.html)

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
</html>
```

13-3-5. ê²°ê³¼

mockMvcëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆë¥¼ ë„ìš°ì§€ ì•Šê¸° ë•Œë¬¸ì— JSPë¼ë©´ ì¶œë ¥ì´ ë¶ˆê°€ëŠ¥

íƒ€ì„ë¦¬í”„ëŠ” ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆì— ë…ë¦½ì ì¸ ì—”ì§„ì´ë¯€ë¡œ ì‘ë‹µì„ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤

```html
MockHttpServletResponse:
           Status = 200
    Error message = null
          Headers = [Content-Language:"en", Content-Type:"text/html;charset=UTF-8"]
     Content type = text/html;charset=UTF-8
             Body = <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
</html>
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
```

**13-4. Thymeleaf ë³€ìˆ˜ í‘œí˜„**

docs : [https://www.thymeleaf.org/doc/articles/standarddialect5minutes.html](https://www.thymeleaf.org/doc/articles/standarddialect5minutes.html)

13-4-1. ğŸ‘€Â (í•„ìˆ˜) Thymeleaf ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¶”ê°€

```html
<html lang="en" xmlns:th="http://www.thymeleaf.org">
```

13-4-2. variable expressions

```html
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1 th:text="${name}">Name</h1>
</body>
</html>
```

13-4-3. ê²°ê³¼ (localhost:8080/hello)

![Untitled](/assets/images/2022-02-19/thymeleaf_template.png)

## 14. HtmlUnit

**14-1. ì˜ì¡´ì„± ì¶”ê°€**

```html
<dependency>
            <groupId>org.seleniumhq.selenium</groupId>
            <artifactId>htmlunit-driver</artifactId>
            <version>3.58.0</version>
            <scope>test</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/net.sourceforge.htmlunit/htmlunit -->
        <dependency>
            <groupId>net.sourceforge.htmlunit</groupId>
            <artifactId>htmlunit</artifactId>
            <version>2.58.0</version>
            <scope>test</scope>
        </dependency>
```

**14-2. ì˜ì¡´ì„± ì„¤ëª…**

14-2-1. htmlunit

htmlunit : html ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

HtmlPage ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ê°ì¢… ì»¨í…ì¸ , ë¸Œë¼ìš°ì € íƒ€ì… ë“±ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

**14-3. í…ŒìŠ¤íŠ¸**

HtmlUnit ì´ MockMvc ë³´ë‹¤ ì¢‹ë‹¤ ì´ëŸ°ê²Œ ì•„ë‹ˆê³ , ì·¨í–¥ì˜ ë¬¸ì œ!

WebClient ì•ˆì—ì„œ MockMvcë¥¼ ì´ë¯¸ ì“°ê³  ìˆë‹¤

```java
@RunWith(SpringRunner.class)
@WebMvcTest(SampleController.class)
public class SampleControllerTest {

    @Autowired
    MockMvc mockMvc;
    
    @Autowired
    WebClient webClient;

    @Test
    public void helloHtmlUnit() throws IOException {
        HtmlPage page = webClient.getPage("/hello");
        HtmlHeading1 h1 = page.getFirstByXPath("//h1");
        assertThat(h1.getTextContent()).isEqualToIgnoringCase("cherrue");
    }
```

## 15. ExceptionHandler

ìƒˆ í”„ë¡œì íŠ¸(springbootexception)

**15-1. ê¸°ë³¸ ì—ëŸ¬í•¸ë“¤ëŸ¬**

ìŠ¤í”„ë§ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ë©´ ê¸°ë³¸ì ì¸ ì—ëŸ¬ í•¸ë“¤ëŸ¬ê°€ ë“±ë¡ì´ ë˜ì–´ìˆë‹¤

ì˜ˆë¥¼ ë“¤ë©´ 404 â†’ Whitelabel Error Page(machine client) / json 404 (curl rest api)

**BasicErrorController ì†ŒìŠ¤ ì¼ë¶€**

```java
// Whitelabel Error Page
@RequestMapping(
    produces = {"text/html"}
)
public ModelAndView errorHtml(HttpServletRequest request, HttpServletResponse response) {
		...
		return modelAndView != null ? modelAndView : new ModelAndView("error", model);
}
// json 404 not found
@RequestMapping
public ResponseEntity<Map<String, Object>> error(HttpServletRequest request) {
    HttpStatus status = this.getStatus(request);
    if (status == HttpStatus.NO_CONTENT) {
        return new ResponseEntity(status);
    } else {
        Map<String, Object> body = this.getErrorAttributes(request, this.isIncludeStackTrace(request, MediaType.ALL));
        return new ResponseEntity(body, status);
    }
}
```

**15-2. ìŠ¤í”„ë§ ë¶€íŠ¸ ì—ëŸ¬ í•¸ë“¤ë§ ë°©ë²•**

@ExceptionHandler ì‚¬ìš©

ì»¨íŠ¸ë¡¤ëŸ¬ ì•ˆì—ì„œ ë°œìƒí•œ SampleExceptionì€ ëª¨ë‘ @ExceptionHandlerê°€ ë¶™ì€ í•¨ìˆ˜ì—ì„œ ëª¨ë‘ ì²˜ë¦¬í•œë‹¤.

â†’ ì „ì—­ì ìœ¼ë¡œ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´ @ControllerAdviceê°€ ë¶™ì€ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì„ ì–¸í•˜ë©´ ëœë‹¤.

â†’ ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ ìì²´ë¥¼ ê³ ì¹˜ê³  ì‹¶ë‹¤ë©´ ErrorControllerë¥¼ êµ¬í˜„(default BasicErrorController)

```java
@Controller
public class SampleController {
    @GetMapping("/hello")
    public String hello() {
        throw new SampleException();
    }

    @ExceptionHandler(SampleException.class)
    public @ResponseBody AppError sampleError(SampleException e) {
        AppError appError = new AppError();
        appError.setMessage("error.app.key");
        appError.setMessage("IDK IDK IDK");
        return appError;
    }
}
// SampleException.java
public class SampleException extends RuntimeException {
}
// AppError.java
public class AppError {
    private String message;

    private String reason;

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public String getReason() {
        return reason;
    }

    public void setReason(String reason) {
        this.reason = reason;
    }
}
```

ê²°ê³¼

```java
$ curl localhost:8080/hello 
{"message":"IDK IDK IDK","reason":null}
```

**15-3. ì»¤ìŠ¤í…€ ì—ëŸ¬ í˜ì´ì§€**

ìƒíƒœ ì½”ë“œì— ë”°ë¼ ë³´ì¼ ì—ëŸ¬í˜ì´ì§€ë¥¼ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹¤

ê²½ë¡œ : main/resources/static/ ë˜ëŠ” main/resources/template

íŒŒì¼ëª… : status codeì™€ ì¼ì¹˜í•˜ê±°ë‚˜ xë¡œ ì™€ì¼ë“œì¹´ë“œ ì‚¬ìš© ê°€ëŠ¥

ë™ì ì¸ í˜ì´ì§€ë¡œ ì“°ê³  ì‹¶ë‹¤ë©´ : ErrorViewResolver êµ¬í˜„í•˜ë©´ ë˜ì§€ë§Œ ì„œë²„ë‹¨ì—ì„œ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ì§œëŠ” ê²Œ ë‚«ë‹¤

ì˜ˆì‹œ : 404.html, 5xx.html

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>404</h1>
</body>
</html>
```

## 15. Spring HATEOAS

ì‹ ê·œ í”„ë¡œì íŠ¸ ìƒì„± : demospringhateoas

spring HATEOAS : springì—ì„œ HATEOASë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ íˆ´

HATEOAS : Hypermedia As The Engine Of Application State

- REST apiì—ì„œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•  ë•Œ ì—°ê´€ëœ ë§í¬ ì •ë³´ë“¤ ê¹Œì§€ ê°™ì´ ì œê³µí•˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì œê³µë°›ì€ ì—°ê´€ëœ ë§í¬ë¥¼ ê°€ì§€ê³  ë§í¬ì— ì ‘ê·¼í•˜ëŠ” ê²ƒ
- ì„œë²„ì—ì„œ ë£¨íŠ¸ í˜ì´ì§€ë¥¼ ì¤„ ë•Œ relationì´ ìˆëŠ” í˜ì´ì§€ ì •ë³´ë¥¼ ë¯¸ë¦¬ í´ë¼ì´ì–¸íŠ¸í•œí…Œ ì œê³µí•˜ê³ ,
í´ë¼ì´ì–¸íŠ¸ëŠ” í˜ì´ì§€ë¥¼ ì´ë™í•˜ê³  ì‹¶ì„ ë•Œ ì„œë²„ê°€ ì¤€ hrefë¥¼ ê°€ì§€ê³  ì´ë™

```html
<!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-hateoas -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-hateoas</artifactId>
    <version>2.2.0.RELEASE</version>
</dependency>
```

**15-1. ìë™ì„¤ì • ë˜ëŠ” ê¸°ëŠ¥**

**ObjectMapper**

ì‘ë‹µì„ Jsonìœ¼ë¡œ ë§Œë“¤ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥. (jackson)

Jackson2ObjectMapperBuilderê°€ ì£¼ì… â†’ ObjectMapper ìƒì„±í•  í•„ìš” ì—†ìŒ

- application.propertiesì—ì„œ objectMapperë¥¼ ì„¤ì •í•´ì¤„ ìˆ˜ ìˆìŒ

**LinkDiscovers**

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë§í¬ì •ë³´ë¥¼ Rel ì´ë¦„ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆëŠ” XPath í™•ì¥ í´ë˜ìŠ¤. í¸ì˜ì„±ì´ë¼ê³  ë³´ë©´ ëœë‹¤

**15-2. ë§í¬ ë‹¬ê¸° (deprecated)**

2.2.0 RELEASEì—ëŠ” Resource ê°ì²´ê°€ ì—†ìŒ..!

```java
@RestController
public class SampleController {
    @GetMapping("/hello")
    public Resource<Hello> hello() {
        Hello hello = new Hello();
        hello.setPrefix("Hey,");
        hello.setName("Cherrue");

        Resource<Hello> helloResource = new Resource<>(hello);
        helloResource.add(linkTo(methodOn(SampleController.class).hello()).withSelfRel())
        return helloResource;
    }
}
```

## 16. CORS

Cross Origin Resource Sharing : Single-Origin Policyë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•œ ì›¹ í‘œì¤€ ê¸°ìˆ 

Single-Origin Policy í•˜ë‚˜ì˜ ì˜¤ë¦¬ì§„ì—ì„œë§Œ ìš”ì²­ì´ ê°€ëŠ¥í•œ ì œí•œ ì •ì±…

Origin = URI ìŠ¤í‚¤ë§ˆ(http, https) + hostname + port

â†’ ê¸°ë³¸ì ìœ¼ë¡œ localhost:8080ê³¼ localhost:8081 ì‘ë‹µì„ í•©ì³ì„œ ë°˜í™˜í•˜ê³  ì‹¶ì–´ë„ ëª» í•¨

Spring ì—ì„œëŠ” CORSë¥¼ ì“°ë ¤ë©´ ë¹ˆ ì„¤ì •ì„ ì´ê²ƒì €ê²ƒ í•´ì£¼ì—ˆì–´ì•¼ í•˜ëŠ”ë°, ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ìë™ì„¤ì • ì§€ì›

â†’ @CrossOrigin

16-1. **í”„ë¡œì íŠ¸ ë‘ ê°œ ìƒì„± (springcorsserver(8080í¬íŠ¸), springcorsclient(18080í¬íŠ¸))**

ğŸ“ port ì„¤ì • : application.properties > server.port=18080

```java
@SpringBootApplication
@RestController
public class SpringcorsserverApplication {
    @GetMapping("/hello")
    public String hello () {
        return "hello";
    }

    public static void main(String[] args) {
        SpringApplication.run(SpringcorsserverApplication.class, args);
    }
}
```

```html
<!-- SpringcorsclientApplication/resources/static/index.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>CORS client</h1>
<script src="/webjars/jquery/3.6.0/dist/jquery.min.js"></script>
<script>
    $(function() {
        $.ajax("http://localhost:8080/hello")
            .done(function(msg) {
            alert("msg");
            })
            .fail(function() {
            alert("fail");
            });
    })
</script>
</body>
</html>
```

**ê²°ê³¼**

![cors_fail](/assets/images/2022-02-19/cors_fail.png)

Access-Control-Allow-Origin í—¤ë”ë¥¼ í™•ì¸í–ˆëŠ”ë° ì˜¤ë¦¬ì§„ì´ ì•„ë‹ˆë¼ëŠ” ì˜¤ë¥˜ ë°œìƒ

16-2. ì„œë²„ì¸¡ api í•˜ë‚˜ì— CrossOrigin ì„¤ì •

```java
@SpringBootApplication
@RestController
public class SpringcorsserverApplication {
    @CrossOrigin(origins = "http://localhost:18080")
    @GetMapping("/hello")
    public String hello () {
        return "hello";
    }

    public static void main(String[] args) {
        SpringApplication.run(SpringcorsserverApplication.class, args);
    }
}
```

16-3. ì„œë²„ì— ì „ì—­ CORS ì„¤ì •

WebMvcConfiguration êµ¬í˜„ : ê¸°ë³¸ ì„¤ì •ì€ ê·¸ëŒ€ë¡œ ë‘ê³ , ë‚´ê°€ ì—¬ê¸°ì„œ êµ¬í˜„í•œ ì• ë“¤ë§Œ ì˜¤ë²„ë¼ì´ë“œ ë¨

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOrigins("http://localhost:18080");
    }
}
```