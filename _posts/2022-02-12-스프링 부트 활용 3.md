---
layout: single
title: \[ê°•ì˜ìš”ì•½\] ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš© - ìŠ¤í”„ë§ ì›¹ MVC (1)
date: 2022-02-11 20:52:00 +0900
categories: lecture_summary springboot springboot_getting_started
toc: true
toc_sticky: true
toc_label: Contents
---

ê°œì¸ì ì¸ í•™ìŠµì„ ìœ„í•œ [Inflearn - ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš©](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/dashboard)(ë°±ê¸°ì„ ) ê°•ì˜ ìš”ì•½ì…ë‹ˆë‹¤.

ê°œë…ê³¼ ì›ë¦¬ ìœ„ì£¼ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.

[ì´ì „ ê¸€](https://cherrue.github.io/lecture_summary/springboot/springboot_getting_started/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%ED%99%9C%EC%9A%A9-2/) ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.

# 4ë¶€. ìŠ¤í”„ë§ ë¶€íŠ¸ í™œìš©

---

## 7. ìŠ¤í”„ë§ ì›¹ MVC 1ë¶€ : ì†Œê°œ

7-1. ìŠ¤í”„ë§ ë¶€íŠ¸ MVC ë¥¼ ì´ìš©í•´ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°

í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° : spring-boot-starter-web, test ì£¼ì…

```java
// UserControllerTest.java
@RunWith(SpringRunner.class)
@WebMvcTest(UserController.class)
public class UserControllerTest {

    @Autowired
    MockMvc mockMvc;

    @Test
    public void hello() throws Exception {
        mockMvc.perform(get("/hello"))
                .andExpect(status().isOk())
                .andExpect(content().string("hello"));
    }
}

// UserController
@RestController
public class UserController {
    @GetMapping("/hello")
    public String hello() {
        return "hello";
    }
}
```

MockMvc : WebMvcTest ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì£¼ì…ë°›ì„ ìˆ˜ ìˆëŠ” ê°ì²´

ìœ„ì™€ ê°™ì´ ì½”ë”©í•˜ë©´ ê°„ë‹¨í•œ MVCë¥¼ ë°”ë¡œ ë§Œë“¤ì–´ì„œ ì“´ ê²ƒ

ê°€ëŠ¥í•œ ì´ìœ  : spring-boot-autoconfigurer > spring.factories > WebMvcAutoConfiguration ì´ ìë™ ì ìš©

7-2. ìŠ¤í”„ë§ MVC í™•ì¥ê³¼ ì¬ì •ì˜

ìë™ ì„¤ì •ì˜ ê¸°ë³¸ ê¸°ëŠ¥ì—ì„œ **ì¶”ê°€**ë¡œ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´? í™•ì¥ = @Configuration + WebMvcConfigurer

ìë™ ì„¤ì •ì˜ ê¸°ë³¸ ê¸°ëŠ¥ë“¤ë„ ëª¨ë‘ ë‚´ê°€ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´? ì¬ì •ì˜ = @Configuration + @EnableWebMvc

```java
@Configuration
//@EnableWebMvc : ì´ê±¸ ë¶™ì´ë©´ ê¸°ë³¸ ì„¤ì •ì´ ë‹¤ ì—†ì–´ì§
public class WebConfig implements WebMvcConfigurer {
//    void configureAsyncSupport(AsyncSupportConfigurer configurer) {}
// WebMvcConfigurer ì— ì„ ì–¸ëœ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.
}
```


## 8. HttpMessageConverters

HttpMessageConverters : Http ìš”ì²­ ë³¸ë¬¸ì„ ì—­ì§ë ¬í™”í•˜ê±°ë‚˜, ê°ì²´ë¥¼ ì‘ë‹µìœ¼ë¡œ ì§ë ¬í™”í•  ë•Œ ì‚¬ìš©

- @RequestBody, @ResponseBody ê°€ ë¶™ìœ¼ë©´ ì•Œì•„ì„œ ì‚¬ìš©ë¨
- @RestControllerì¸ ê²½ìš°ì—ëŠ” @ResponseBody ìƒëµ ê°€ëŠ¥
- @Controllerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° View Name Resolverê°€ view íŒŒì¼ì„ ì°¾ìŒ

```java
@RestController
public class UserController {
    @GetMapping("/hello")
    public String hello() {
        return "hello";
    }

    @PostMapping("/user")
    //public @ResponseBody User Create(@RequestBody User user) {
    public /*@ResponseBody*/ User Create(@RequestBody User user) {
        return null;
    }
}
```

content-type í—¤ë”ì— ë”°ë¼ ì‚¬ìš©ë˜ëŠ” ì»¨ë²„í„°ê°€ ë°”ë€œ

ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ê°’ì´ í¬í•¨ëœ ê°ì²´ë¼ë©´(ì»´í¬ì§€ì…˜ í•˜ë‹¤ë©´) Jsonì´ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë¨

 â†”Â ë¬¸ìì—´ í•˜ë‚˜ë©´ StringConverterê°€ ì‚¬ìš©ë¨

8-1. ìœ ì € ìƒì„± í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

ğŸš§Â User ê°ì²´ëŠ” ìë°”ë¹ˆ ê·œì•½ì— ë”°ë¼ getter/setter ë¥¼ ê°€ì ¸ì•¼ í•œë‹¤.

```java
		
// test.user.UserControllerTest.java
		@Test
    public void createUser_JSON() throws Exception {
        String userJson = "{\n" +
                "  \"username\": \"cherrue\",\n" +
                "  \"password\": \"123\"\n" +
                "}";
        mockMvc.perform(post("/users/create")
                .contentType(MediaType.APPLICATION_JSON_UTF8)
                .accept(MediaType.APPLICATION_JSON_UTF8)
                .content(userJson))
                    .andExpect(status().isOk())
                    .andExpect(jsonPath("$.username", is(equalTo("cherrue"))))
                    .andExpect(jsonPath("$.password", is(equalTo("123"))));
    }

// UserController.Java
@RestController
public class UserController {
    @GetMapping("/hello")
    public String hello() {
        return "hello";
    }

    //public @ResponseBody User Create(@RequestBody User user) {
    @PostMapping("/users/create")
    public /*@ResponseBody*/ User Create(@RequestBody User user) {
        return user;
    }
}

// User.java
public class User {
    private Long id;

    private String username;

    private String password;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

}
```

## 9. ViewResolve

ìš”ì²­ì˜ í¬ë§· : header > contentType

ì‘ë‹µì˜ í¬ë§· : accept header

accept header ê°€ ì—†ë‹¤ë©´?<br/>
ì–´ë–¤ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ê·¸ ìš”ì²­ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ëª¨ë“  ë‹µì„ ì°¾ì•„ë‚¸ë‹¤<br/>
ìµœì¢…ì ìœ¼ë¡œ accept headerë¥¼ ë³´ê³  ì œì¼ ì ì ˆí•œ ê±¸ ë°˜í™˜<br/>
accept headerê°€ ì•ˆ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ format(/path?format=pdf) ì´ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

```java
// UserControllerTest.java
		@Test
    public void createUser_XML() throws Exception {
        String userJson = "{\n" +
                "  \"username\": \"cherrue\",\n" +
                "  \"password\": \"123\"\n" +
                "}";
        mockMvc.perform(post("/users/create")
                .contentType(MediaType.APPLICATION_JSON_UTF8)
                .accept(MediaType.APPLICATION_XML)
                .content(userJson))
                    .andExpect(status().isOk())
                .andExpect(xpath("/User/username").string("cherrue"))
                .andExpect(xpath("/User/password").string("123"));
    }
```

ìœ„ í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ë¥¼ ì‘ì„±í•˜ë©´ ì•Œì•„ì„œ XMLë¡œ ë±‰ì–´ì§€ëŠ”ë°, ContentNegotiatingViewResolverê°€ ì‘ì—…í•´ ì¤€ ê²ƒ

**ê²°ê³¼**

```java
Resolved Exception:
             Type = org.springframework.web.HttpMediaTypeNotAcceptableException

java.lang.AssertionError: Status 
Expected :200
Actual   :406
```

ğŸ“Œ ë¬¸ì œë°œìƒ XML ë©”ì‹œì§€ ì»¨ë²„í„°ê°€ ì—†ì–´ì„œ 406 ì—ëŸ¬ ë°œìƒ

HttpMessageConvertersConfiguration > JacksonHttpMessageConvertersConfiguration

```java
		@ConditionalOnClass({XmlMapper.class}) // XmlMapperê°€ ìˆì„ ë•Œ ë“±ë¡í•˜ë¼ëŠ” ì„¤ì •
    @ConditionalOnBean({Jackson2ObjectMapperBuilder.class})
    protected static class MappingJackson2XmlHttpMessageConverterConfiguration {
        protected MappingJackson2XmlHttpMessageConverterConfiguration() {
        }

        @Bean
        @ConditionalOnMissingBean
        public MappingJackson2XmlHttpMessageConverter mappingJackson2XmlHttpMessageConverter(Jackson2ObjectMapperBuilder builder) {
            return new MappingJackson2XmlHttpMessageConverter(builder.createXmlMapper(true).build());
        }
    }
```

ğŸ€ í•´ê²° : XmlMapperì„ í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— ì¶”ê°€í•˜ê¸° = ì˜ì¡´ì„± ì¶”ê°€í•˜ê¸°

```java
// Pom.xml
				<dependency>
            <groupId>com.fasterxml.jackson.dataformat</groupId>
            <artifactId>jackson-dataformat-xml</artifactId>
            <version>2.9.6</version>
        </dependency>
```

**ê²°ê³¼ : ì„±ê³µí•˜ë©´ ì•„ë¬´ê²ƒë„ ì¶œë ¥í•˜ì§€ ì•ŠëŠ”ë‹¤.**

![test_passed](/assets/images/2022-02-15/test_passed.png)