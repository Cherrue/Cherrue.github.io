---
layout: single
title: \[ê°•ì˜ìš”ì•½\] ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš© - ìŠ¤í”„ë§ ì›¹ MVC (1/2)
date: 2022-02-11 20:52:00 +0900
categories: lecture_summary springboot springboot_getting_started
toc: true
toc_sticky: true
toc_label: Contents
show_in_home: false
---

ê°œì¸ì ì¸ í•™ìŠµì„ ìœ„í•œ [Inflearn - ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš©](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/dashboard)(ë°±ê¸°ì„ ) ê°•ì˜ ìš”ì•½ì…ë‹ˆë‹¤.

ê°œë…ê³¼ ì›ë¦¬ ìœ„ì£¼ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.

[ì´ì „ ê¸€](https://cherrue.github.io/lecture_summary/springboot/springboot_getting_started/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%ED%99%9C%EC%9A%A9-2/) ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.

# 4ë¶€. ìŠ¤í”„ë§ ë¶€íŠ¸ í™œìš©

---

## 7. ìŠ¤í”„ë§ ì›¹ MVC 1ë¶€ : ì†Œê°œ

7-1. ìŠ¤í”„ë§ ë¶€íŠ¸ MVC ë¥¼ ì´ìš©í•´ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ë§Œë“¤ê¸°

í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° : spring-boot-starter-web, test ì£¼ì…

```java
// UserControllerTest.java
@RunWith(SpringRunner.class)
@WebMvcTest(UserController.class)
public class UserControllerTest {

    @Autowired
    MockMvc mockMvc;

    @Test
    public void hello() throws Exception {
        mockMvc.perform(get("/hello"))
                .andExpect(status().isOk())
                .andExpect(content().string("hello"));
    }
}

// UserController
@RestController
public class UserController {
    @GetMapping("/hello")
    public String hello() {
        return "hello";
    }
}
```

MockMvc : WebMvcTest ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ ì£¼ì…ë°›ì„ ìˆ˜ ìˆëŠ” ê°ì²´

ìœ„ì™€ ê°™ì´ ì½”ë”©í•˜ë©´ ê°„ë‹¨í•œ MVCë¥¼ ë°”ë¡œ ë§Œë“¤ì–´ì„œ ì“´ ê²ƒ

ê°€ëŠ¥í•œ ì´ìœ  : spring-boot-autoconfigurer > spring.factories > WebMvcAutoConfiguration ì´ ìë™ ì ìš©

7-2. ìŠ¤í”„ë§ MVC í™•ì¥ê³¼ ì¬ì •ì˜

ìë™ ì„¤ì •ì˜ ê¸°ë³¸ ê¸°ëŠ¥ì—ì„œ **ì¶”ê°€**ë¡œ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´? í™•ì¥ = @Configuration + WebMvcConfigurer

ìë™ ì„¤ì •ì˜ ê¸°ë³¸ ê¸°ëŠ¥ë“¤ë„ ëª¨ë‘ ë‚´ê°€ ì„¤ì •í•˜ê³  ì‹¶ë‹¤ë©´? ì¬ì •ì˜ = @Configuration + @EnableWebMvc

```java
@Configuration
//@EnableWebMvc : ì´ê±¸ ë¶™ì´ë©´ ê¸°ë³¸ ì„¤ì •ì´ ë‹¤ ì—†ì–´ì§
public class WebConfig implements WebMvcConfigurer {
//    void configureAsyncSupport(AsyncSupportConfigurer configurer) {}
// WebMvcConfigurer ì— ì„ ì–¸ëœ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤.
}
```


## 8. HttpMessageConverters

HttpMessageConverters : Http ìš”ì²­ ë³¸ë¬¸ì„ ì—­ì§ë ¬í™”í•˜ê±°ë‚˜, ê°ì²´ë¥¼ ì‘ë‹µìœ¼ë¡œ ì§ë ¬í™”í•  ë•Œ ì‚¬ìš©

- @RequestBody, @ResponseBody ê°€ ë¶™ìœ¼ë©´ ì•Œì•„ì„œ ì‚¬ìš©ë¨
- @RestControllerì¸ ê²½ìš°ì—ëŠ” @ResponseBody ìƒëµ ê°€ëŠ¥
- @Controllerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° View Name Resolverê°€ view íŒŒì¼ì„ ì°¾ìŒ

```java
@RestController
public class UserController {
    @GetMapping("/hello")
    public String hello() {
        return "hello";
    }

    @PostMapping("/user")
    //public @ResponseBody User Create(@RequestBody User user) {
    public /*@ResponseBody*/ User Create(@RequestBody User user) {
        return null;
    }
}
```

content-type í—¤ë”ì— ë”°ë¼ ì‚¬ìš©ë˜ëŠ” ì»¨ë²„í„°ê°€ ë°”ë€œ

ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ê°’ì´ í¬í•¨ëœ ê°ì²´ë¼ë©´(ì»´í¬ì§€ì…˜ í•˜ë‹¤ë©´) Jsonì´ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë¨

 â†”Â ë¬¸ìì—´ í•˜ë‚˜ë©´ StringConverterê°€ ì‚¬ìš©ë¨

8-1. ìœ ì € ìƒì„± í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

ğŸš§Â User ê°ì²´ëŠ” ìë°”ë¹ˆ ê·œì•½ì— ë”°ë¼ getter/setter ë¥¼ ê°€ì ¸ì•¼ í•œë‹¤.

```java
		
// test.user.UserControllerTest.java
		@Test
    public void createUser_JSON() throws Exception {
        String userJson = "{\n" +
                "  \"username\": \"cherrue\",\n" +
                "  \"password\": \"123\"\n" +
                "}";
        mockMvc.perform(post("/users/create")
                .contentType(MediaType.APPLICATION_JSON_UTF8)
                .accept(MediaType.APPLICATION_JSON_UTF8)
                .content(userJson))
                    .andExpect(status().isOk())
                    .andExpect(jsonPath("$.username", is(equalTo("cherrue"))))
                    .andExpect(jsonPath("$.password", is(equalTo("123"))));
    }

// UserController.Java
@RestController
public class UserController {
    @GetMapping("/hello")
    public String hello() {
        return "hello";
    }

    //public @ResponseBody User Create(@RequestBody User user) {
    @PostMapping("/users/create")
    public /*@ResponseBody*/ User Create(@RequestBody User user) {
        return user;
    }
}

// User.java
public class User {
    private Long id;

    private String username;

    private String password;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

}
```

## 9. ViewResolve

ìš”ì²­ì˜ í¬ë§· : header > contentType

ì‘ë‹µì˜ í¬ë§· : accept header

accept header ê°€ ì—†ë‹¤ë©´?<br/>
ì–´ë–¤ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ê·¸ ìš”ì²­ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ëª¨ë“  ë‹µì„ ì°¾ì•„ë‚¸ë‹¤<br/>
ìµœì¢…ì ìœ¼ë¡œ accept headerë¥¼ ë³´ê³  ì œì¼ ì ì ˆí•œ ê±¸ ë°˜í™˜<br/>
accept headerê°€ ì•ˆ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì€ format(/path?format=pdf) ì´ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

```java
// UserControllerTest.java
		@Test
    public void createUser_XML() throws Exception {
        String userJson = "{\n" +
                "  \"username\": \"cherrue\",\n" +
                "  \"password\": \"123\"\n" +
                "}";
        mockMvc.perform(post("/users/create")
                .contentType(MediaType.APPLICATION_JSON_UTF8)
                .accept(MediaType.APPLICATION_XML)
                .content(userJson))
                    .andExpect(status().isOk())
                .andExpect(xpath("/User/username").string("cherrue"))
                .andExpect(xpath("/User/password").string("123"));
    }
```

ìœ„ í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ë¥¼ ì‘ì„±í•˜ë©´ ì•Œì•„ì„œ XMLë¡œ ë±‰ì–´ì§€ëŠ”ë°, ContentNegotiatingViewResolverê°€ ì‘ì—…í•´ ì¤€ ê²ƒ

**ê²°ê³¼**

```java
Resolved Exception:
             Type = org.springframework.web.HttpMediaTypeNotAcceptableException

java.lang.AssertionError: Status 
Expected :200
Actual   :406
```

ğŸ“Œ ë¬¸ì œë°œìƒ XML ë©”ì‹œì§€ ì»¨ë²„í„°ê°€ ì—†ì–´ì„œ 406 ì—ëŸ¬ ë°œìƒ

HttpMessageConvertersConfiguration > JacksonHttpMessageConvertersConfiguration

```java
		@ConditionalOnClass({XmlMapper.class}) // XmlMapperê°€ ìˆì„ ë•Œ ë“±ë¡í•˜ë¼ëŠ” ì„¤ì •
    @ConditionalOnBean({Jackson2ObjectMapperBuilder.class})
    protected static class MappingJackson2XmlHttpMessageConverterConfiguration {
        protected MappingJackson2XmlHttpMessageConverterConfiguration() {
        }

        @Bean
        @ConditionalOnMissingBean
        public MappingJackson2XmlHttpMessageConverter mappingJackson2XmlHttpMessageConverter(Jackson2ObjectMapperBuilder builder) {
            return new MappingJackson2XmlHttpMessageConverter(builder.createXmlMapper(true).build());
        }
    }
```

ğŸ€ í•´ê²° : XmlMapperì„ í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— ì¶”ê°€í•˜ê¸° = ì˜ì¡´ì„± ì¶”ê°€í•˜ê¸°

```java
// Pom.xml
				<dependency>
            <groupId>com.fasterxml.jackson.dataformat</groupId>
            <artifactId>jackson-dataformat-xml</artifactId>
            <version>2.9.6</version>
        </dependency>
```

**ê²°ê³¼ : ì„±ê³µí•˜ë©´ ì•„ë¬´ê²ƒë„ ì¶œë ¥í•˜ì§€ ì•ŠëŠ”ë‹¤.**

![test_passed](/assets/images/2022-02-15/test_passed.png)

## 10. ì •ì  ë¦¬ì†ŒìŠ¤ ì§€ì›

ë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ” í˜ì´ì§€ê°€ ì•„ë‹Œ, ë°”ë¡œ ì„œë¹„ìŠ¤í•˜ë©´ ë˜ëŠ” íŒŒì¼ì„ íŠ¹ì • ê²½ë¡œì— ë„£ìœ¼ë©´ ìŠ¤í”„ë§ì´ ì„œë¹„ìŠ¤

**10-1. ì •ì  ë¦¬ì†ŒìŠ¤ ë§¤í•‘ â€œ/**â€**

ì˜ˆì‹œ) /hello.html ìš”ì²­ â†’ /static/hello.html íŒŒì¼ ì„œë¹„ìŠ¤

**ê¸°ë³¸ê°’**

- classpath:/static
- classpath:/public
- classpath:/resources
- classpath:/META-INF/resources

```html
<!-- src.main.resources.static / hello.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
Hello static method!
</body>
</html>
```

**ê²°ê³¼**
![static_resource](/assets/images/2022-02-17/static_resource.png)

**10-1-1. ì •ì  ë¦¬ì†ŒìŠ¤ ìºì‹±**

If-Modified-Since ì— ìµœê·¼ ë³€ê²½ ì‹œê°„ì„ ê¸°ë¡í•˜ì—¬ 304 ì‘ë‹µë§Œ ë³´ë‚´ ì†ë„ë¥¼ ë†’ì¸ë‹¤.

- Http status 304 : Not Modified. ë³€ê²½ ì‚¬í•­ì´ ì—†ì–´ ë‹¤ì‹œ ë³´ë‚´ì§€ ì•Šê² ë‹¤ëŠ” ì‘ë‹µ ì½”ë“œ

**10-1-2. ì •ì  ë¦¬ì†ŒìŠ¤ ê¸°ë³¸ê°’ ë³€ê²½**

ê¸°ë³¸ url ë§¤í•‘ ê²½ë¡œ ë³€ê²½ : spring.mvc.static-path-pattern

ì •ì  ë¦¬ì†ŒìŠ¤ íƒìƒ‰ ìœ„ì¹˜ ë³€ê²½

- spring.mvc.static-path-locations (ëª¨ë“  ê¸°ë³¸ê°’ì´ ë‚ ì•„ê°€ì„œ ë¹„ì¶”ì²œ)
- WebMvcConfigurer.addResourceHandlers êµ¬í˜„ (ì„¤ì •í•œ ê°’ë§Œ ì¶”ê°€ ë¨)

```java
// {APP_HOME}/config/WebConfig.java
@Configuration
//@EnableWebMvc : ì´ê±¸ ë¶™ì´ë©´ ê¸°ë³¸ ì„¤ì •ì´ ë‹¤ ì—†ì–´ì§
public class WebConfig implements WebMvcConfigurer {
//    void configureAsyncSupport(AsyncSupportConfigurer configurer) {}

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        WebMvcConfigurer.super.addResourceHandlers(registry);
        registry.addResourceHandler("m/**")
                .addResourceLocations("classpath:/m/") // ë°˜ë“œì‹œ /ë¡œ ëë‚´ì•¼ ë§¤í•‘ì´ ì˜ ëœë‹¤.
                .setCachePeriod(20);
    }
}
```

**ê²°ê³¼**

![static_resource_path](/assets/images/2022-02-17/static_resource_path.png)

## 11. ì›¹ JAR

> ì›¹ JAR : ë™ì ìœ¼ë¡œ ì»¨í…ì¸ ë¥¼ ìƒì‚°í•  ë•Œ ì‚¬ìš©í•  Front ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ jarë¡œ ë¬¶ì€ ê²ƒ
> 

ëŒ€ë¶€ë¶„ maven ì¤‘ì•™ ì €ì¥ì†Œì—ë„ ì˜¬ë¼ì™€ìˆì–´ì„œ pom.xmlì— ì¶”ê°€í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥

```xml
// pom.xml
<!-- https://mvnrepository.com/artifact/org.webjars.bower/jquery -->
        <dependency>
            <groupId>org.webjars.bower</groupId>
            <artifactId>jquery</artifactId>
            <version>3.3.1</version>
        </dependency>
```

```html
<!-- hello.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
Hello static method!
<script src="/webjars/jquery/3.3.1/dist/jquery.min.js"></script>
<script>
    $(function() {
        alert("ready"); // í™”ë©´ì´ ë¡œë”© ë˜ë©´ alert ë°œìƒ
    });
</script>
</body>
</html>
```

**11-1. webjars-locator-core**

webjarsì˜ ë²„ì „ì´ ë°”ë€Œë©´ ì—¬ê¸°ì €ê¸° í•˜ë“œ ì½”ë”©ëœ ë²„ì „ì„ ë°”ê¾¸ëŠ” ê²ƒì´ ì–´ë ¤ì›€

webjars-locator-coreëŠ” ì´ê±¸ ì•Œì•„ì„œ í•´ì¤€ë‹¤

ìŠ¤í”„ë§ì˜ resource chaining(resource handler + resource transformer)ì˜ ê¸°ëŠ¥ì„ í™œìš©í•œ ê²ƒ

```xml
// pom.xml
<!-- https://mvnrepository.com/artifact/org.webjars/webjars-locator-core -->
        <dependency>
            <groupId>org.webjars</groupId>
            <artifactId>webjars-locator-core</artifactId>
            <version>0.35</version>
        </dependency>
```

```xml
<!-- hello.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
Hello static method!
<!-- ì´ì œ ë²„ì „ì´ ì—†ì–´ë„ ëœë‹¤. -->
<!-- <script src="/webjars/jquery/3.3.1/dist/jquery.min.js"></script> -->
<script src="/webjars/jquery/dist/jquery.min.js"></script>
<script>
    $(function() {
        alert("ready");
    });
</script>
</body>
</html>
```

**ê²°ê³¼**

![webjar](/assets/images/2022-02-17/webjar.png)

## 12. Index í˜ì´ì§€ì™€ íŒŒë¹„ì½˜

**12-1. welcome í˜ì´ì§€**

> root(/) ë¡œ ìš”ì²­í•˜ë©´ ë‚˜ì˜¤ëŠ” í˜ì´ì§€
> 

ì œê³µ : index.html > index.í…œí”Œë¦¿ > ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ì—ëŸ¬ í˜ì´ì§€

- index.html : ì •ì  í˜ì´ì§€
- index.í…œí”Œë¦¿ : ë™ì  í˜ì´ì§€

spring.mvc.static-path-locations ì„¤ì •ë˜ì–´ìˆìœ¼ë©´ staticì´ root

![welcome_page](/assets/images/2022-02-17/welcome_page.png)

**12-2. íŒŒë¹„ì½˜**

íŒŒë¹„ì½˜ ìƒì„± ì‚¬ì´íŠ¸ : [https://favicon.io/favicon-generator/](https://favicon.io/favicon-generator/)

![favicon](/assets/images/2022-02-17/favicon.png)

[íŒŒë¹„ì½˜ íŒŒì¼ ë°›ê¸°](https://raw.githubusercontent.com/Cherrue/Springboot/master/demospringmvc/src/main/resources/static/favicon.ico)

ë§Œë“¤ê±°ë‚˜ ë‚´ë ¤ë°›ì€ favicon.ico íŒŒì¼ì„ resources í•˜ìœ„ì— ë„£ê³  ì¬ê¸°ë™í•˜ë©´ íŒŒë¹„ì½˜ì´ ì ìš© ëœë‹¤.

íŒŒë¹„ì½˜ì´ í•œ ë²ˆ ìºì‹±ë˜ë©´ ë¸Œë¼ìš°ì € ë‹«ì„ ë•Œ ê¹Œì§€ ìœ ì§€ë˜ì–´ì„œ, ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ(safari) ì—´ì—ˆë‹¤

![favicon_page](/assets/images/2022-02-17/favicon_page.png)