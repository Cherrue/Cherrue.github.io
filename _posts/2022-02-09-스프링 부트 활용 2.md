---

layout: single
title: \[ê°•ì˜ìš”ì•½\] ìŠ¤í”„ë§ ë¶€íŠ¸ ê°œë…ê³¼ í™œìš© - í™œìš© ê¸°ë³¸ (2)
date: 2022-02-08 22:20:00 +0900
categories: lecture_summary springboot springboot_getting_started

toc: true
toc_sticky: true
toc_label: Contents

---

ê°œì¸ì ì¸ í•™ìŠµì„ ìœ„í•œ [Inflearn - ìŠ¤í”„ë§ë¶€íŠ¸ ê°œë…ê³¼ í™œìš©](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8/dashboard)(ë°±ê¸°ì„ ) ê°•ì˜ ìš”ì•½ì…ë‹ˆë‹¤.

ê°œë…ê³¼ ì›ë¦¬ ìœ„ì£¼ë¡œ ìš”ì•½í•©ë‹ˆë‹¤.

[ì´ì „ ê¸€](https://cherrue.github.io/lecture_summary/springboot/springboot_getting_started/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%ED%99%9C%EC%9A%A9-1/) ì—ì„œ ì´ì–´ì§‘ë‹ˆë‹¤.

# 4ë¶€. ìŠ¤í”„ë§ ë¶€íŠ¸ í™œìš©

---

## 1. í”„ë¡œíŒŒì¼

1-1. @Profile : profileì´ ì„¤ì •ëœ ê°’ì¼ ë•Œ ì‚¬ìš©í•˜ê² ë‹¤ ì„ ì–¸

@Profile(â€prodâ€) VS @Profile(â€testâ€)

```java
// BaseConfiguration
@Profile("prod")
@Configuration
public class BaseConfiguration {
    @Bean
    public String hello() {
        return "hello";
    }
}

// TestConfiguration
@Profile("test")
@Configuration
public class TestConfiguration {
    @Bean
    public String hello() {
        return "hello";
    }
}

//application.properties
spring.profiles.active=prod
// or
spring.profiles.active=test
```

1-2. spring.profiles.active ì™€ application.properties

profile name ì´ ë¶™ì€ propertiesê°€ default [application.properties](http://application.properties) ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ë†’ìŒ

```java
// application-prod.properties
cherrue.name=cherrue PROD
// application-test.properties
cherrue.name=cherrue TEST

// shell
java -jar target/springinit-0.1.jar --spring.profiles.active=prod
===================
cherrue PROD
===================
```

1-3. spring.profiles.include=smaller

```java
// application-prod.properties
cherrue.name=cherrue PROD
cherrue.profiles.include=smaller
// application-proddb.properties
cherrue.fullName=cherrueFullName

// shell
java -jar target/springinit-0.1.jar --spring.profiles.active=proddb 
```
<br/>

## 2. ë¡œê¹… 1ë¶€: ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ë³¸ ë¡œê±° ì„¤ì •

2-1. í¼ì‚¬ë“œë¥¼ ì ìš©í•˜ì—¬ ë¡œê±°ì˜ ë³€í™”ì— ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•˜ì

springboot log â†’ Commons Loggings (ìœ ì‚¬ê´€ê³„) SLF4J

SLF4J ì™€ Commons Logginsì€ ë¡œê±°ëŠ” ì‹¤ì œ ë¡œê±°ê°€ ì•„ë‹Œ í¼ì‚¬ë“œ(interface. ë¡œê±° ë³€ê²½ì—ë„ ê°™ì€ ë™ì‘ ë³´ì¥)

SpringBoot 1.X ëŒ€ì—ì„œëŠ” Commons Loggingì„ ì œê±°í•˜ê³  SLF4Jë¥¼ ì“°ë ¤ë©´ í¼ì‚¬ë“œì˜ ì¥ì ì„ í¬ê¸°í•´ì•¼ í–ˆìŒ

â‡’ Spring5.X(SpringBoot2.x)ì—ì„œëŠ” Spring-JCLì´ ê¸°ë³¸ ì ìš©ë˜ì–´ Commons Loggingì„ SLF4Jë¡œ ì˜ì¡´ì„±ì„ ì •ë¦¬í–ˆìŒ

jul-to-slf4j â‡’ slf4j â‡’ (implementation) logback 

2-2. ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ë¡œê¹…

- ê¸°ë³¸ í˜•íƒœëŠ” Logbackì´ ì°ì–´ì£¼ëŠ” í˜•íƒœ
- â€”debug = core ë¼ì´ë¸ŒëŸ¬ë¦¬, â€”trace = ëª¨ë“  ë¡œê·¸
- ì»¬ëŸ¬ ì¶œë ¥
    
    ![log](/assets/images/2022-02-09/log.png)
    
- íŒŒì¼ì— ì“°ê¸° : logging.path=logs
    - 10Mbê°€ ë„˜ìœ¼ë©´ ì•„ì¹´ì´ë¸Œ ë¨
- ë¡œê·¸ ë ˆë²¨ ì¡°ì • : logging.level.íŒ¨í‚¤ì§€ëª…=ìˆ˜ì¤€(TRACE,DEBUG,WARN,ERROR)

ë¡œê·¸ ì°ëŠ” ë°©ë²•ì€ ì•„ë˜ ì†ŒìŠ¤ì½”ë“œ ì°¸ê³ 

```java
@Component
public class SampleRunner implements ApplicationRunner {
    @Autowired
    CherrueProperties cherrueProperties;
    @Autowired
    String hello;
    private Logger logger = LoggerFactory.getLogger(SampleRunner.class);
    
		@Override
    public void run(ApplicationArguments args) throws Exception {
        logger.debug("======================");
        logger.debug(cherrueProperties.getName());
        logger.debug(hello);
        logger.debug("======================");
    }

    private void printProgramArguments(ApplicationArguments args) {
        logger.debug("foo : " + args.containsOption("foo"));
        logger.debug("bar : " + args.containsOption("bar"));
    }
}

// application.properties
cherrue.name = Cherrue
cherrue.age = ${random.int(0,100)}
cherrue.fullName = ${cherrue.name} Lee
cherrue.sessionTimeout=25
spring.profiles.active=prod
spring.output.ansi.enabled=always
logging.path=logs
logging.level.me.cherrue=debug
```

## 3. ë¡œê¹… 2ë¶€: ì»¤ìŠ¤í„°ë§ˆì´ì§•

application.propertiesì—ì„œ ì œê³µí•˜ëŠ” ì†ì„± ì´ìƒìœ¼ë¡œ ë¡œê¹…ì„ ì œì–´í•˜ê³  ì‹¶ë‹¤ë©´ log ì„¤ì • íŒŒì¼ ì‘ì„±

- logback-spring.xml (logback.xml)
    - Logback-spring.xml VS logback.xml â‡’ -springì„ ë¶™ì´ë©´ í™˜ê²½ ë³€ìˆ˜ë‚˜ spring ë³€ìˆ˜ í™œìš© ê°€ëŠ¥
    
    ```xml
    <?xml version="1.0" encoding="UTF-8" ?>
    <configuration>
        <include resource="org/springframework/boot/logging/logback/base.xml" />
        <logger name="me.cherrue" level="DEBUG"/>
    </configuration>
    ```
    
- ê¸°ë³¸ê°’ Logbackì„ log4j2ìœ¼ë¡œ ë³€ê²½
    
    ```xml
    <!-- pom.xml -->
    				**<dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-web</artifactId>
                <version>2.2.0.RELEASE</version>
                <exclusions>
                    <exclusion>
                        <groupId>org.springframework.boot</groupId>
                        <artifactId>spring-boot-starter-logging</artifactId>
                    </exclusion>
                </exclusions>
            </dependency>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-starter-log4j2</artifactId>
            </dependency>**
    ```
    


## 4. í…ŒìŠ¤íŠ¸

4-1. í”„ë¡œì íŠ¸ ìƒì„±

```java
// SampleController.java
@RestController
public class SampleController {
    @Autowired
    private SampleService sampleService;

    @GetMapping("/hello")
    public String hello() {
        return "hello " + sampleService.getName();
    }
}

// SampleService.java
@Service
public class SampleService {
    public String getName() {
        return "cherrue";
    }
}

// SpringtestdemoApplication.java
@SpringBootApplication
public class SpringtestdemoApplication {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(SpringtestdemoApplication.class);
        app.run(args);
    }
}
```

4-2. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ ì‘ì„±

```java
// pom.xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <version>2.2.0.RELEASE</version>
</dependency>

// SampleControllerTest.java
@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)
@AutoConfigureMockMvc
public class SampleControllerTest {
    @Autowired
    MockMvc mockMvc;

    @Test
    public void hello() throws Exception {
        mockMvc.perform(get("/hello")).andExpect(status().isOk())
                .andExpect(content().string("hello cherrue"))
                .andDo(print());
    }
}
```

- webEnvironment
    - Mock : í†°ìº£ì„ êµ¬ë™í•˜ì§€ ì•Šê³  ë§ˆì¹˜ ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ì— ìš”ì²­ì„ ë˜ì§„ ê²ƒ ì²˜ëŸ¼ ë™ì‘ì„ í•´ì¤Œ<br/>
    ëŒ€ì‹  MockMvcë¥¼ ê¼­ ì¨ì•¼ í•¨
    - RANDOM_PORT(DEFINED_PORT) : ë‚´ì¥ í†°ìº£ìœ¼ë¡œ ì§„ì§œë¡œ ë„ì›Œì„œ ê±°ê¸°ë‹¤ê°€ ìš”ì²­ì„ ë˜ì§
    TestRestTemplate ì„ ì‚¬ìš©í•˜ê±°ë‚˜, WebTestClient ì‚¬ìš©(WebFluxë¼ì„œ asyncí•œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥)
    

4-3. @MockBean : íŠ¹ì • beanì„ ë°”ê¿”ì„œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©

```java
@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class SampleControllerTest {

    @Autowired
    TestRestTemplate testRestTemplate;

    @MockBean
    SampleService mockSampleService;

    @Test
    public void helloRestTemplate() throws Exception {
        when(mockSampleService.getName()).thenReturn("mockCherrue");
        
        String result = testRestTemplate.getForObject("/hello", String.class);
        assertThat(result).isEqualTo("hello mockCherrue");
    }
}
```

4-4. ğŸ‘ğŸ» WebTestClient (vs RestTemplateClient)

```java
// pom.xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
		<version>2.2.0.RELEASE</version>
</dependency>

// SampleControllerTest.java
@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class SampleControllerTest {
    @MockBean
    SampleService mockSampleService;

    @Autowired
    WebTestClient webTestClient;

    @Test
    public void helloWebTestClient() {
        when(mockSampleService.getName()).thenReturn("mockCherrue");

        webTestClient.get().uri("/hello").exchange()
                .expectStatus().isOk()
                .expectBody(String.class).isEqualTo("hello mockCherrue");
    }
}
```

4-5. slice : í…ŒìŠ¤íŠ¸ í•  ê°ì²´ë§Œ ë¶ˆëŸ¬ ì™€ì„œ ê°€ë³ê²Œ í…ŒìŠ¤íŠ¸í•˜ê³  ì‹¶ì–´!

SpringBootTestëŠ” SpringbootApplicationì„ ëª¨ë‘ ëŒë¦¬ëŠ” í†µí•© í…ŒìŠ¤íŠ¸

1. @JsonTest : ì‘ë‹µì´ ì–´ë–»ê²Œ ë‚˜ê°€ëŠ” ì§€ë§Œ í…ŒìŠ¤íŠ¸
2. @WebMvcTest : controllerë§Œ ë”± í…ŒìŠ¤íŠ¸. ì„œë¹„ìŠ¤ë„ ë¹ˆ ë“±ë¡ì´ ì•ˆ ëœë‹¤
ì„œë¹„ìŠ¤ëŠ” MockBeanìœ¼ë¡œ ë“±ë¡í•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤. <br/>
@WebMvcTest, @WebFluxTest, @DataJpaTest ë“±

```java
@RunWith(SpringRunner.class)
@WebMvcTest
public class SliceControllerTest {
    @Autowired
    MockMvc mockMvc;

    @MockBean
    SampleService mockSampleService;

    @Test
    public void testControllerOnly() throws Exception {
        when(mockSampleService.getName()).thenReturn("mockCherrue");

        mockMvc.perform(get("/hello"))
                .andExpect(content().string("hello mockCherrue"));
    }
}
```

## 5. í…ŒìŠ¤íŠ¸ ìœ í‹¸

ğŸŒŸ OutputCapture : í…ŒìŠ¤íŠ¸ì—ì„œ ë°œìƒí•˜ëŠ” ëª¨ë“  ì•„ì›ƒí’‹ì„ ì¡ìŒ. JUnitì˜ Ruleì„ í™•ì¥í•´ì„œ ë§Œë“  ìœ í‹¸

ë¡œê·¸ë„ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤!!

```java
// SampleController.java
@RestController
public class SampleController {

    Logger logger = LoggerFactory.getLogger(SampleController.class);

    @Autowired
    private SampleService sampleService;

    @GetMapping("/hello")
    public String hello() {
        logger.info("holoman");
        System.out.println("skip");
        return "hello " + sampleService.getName();
    }
}

// SampleControllerTest.java
@RunWith(SpringRunner.class)
@WebMvcTest
public class SliceControllerTest {

    @Rule
    public OutputCapture outputCapture = new OutputCapture();

    @Autowired
    MockMvc mockMvc;

    @MockBean
    SampleService mockSampleService;

    @Test
    public void testControllerOnly() throws Exception {
        when(mockSampleService.getName()).thenReturn("mockCherrue");

        mockMvc.perform(get("/hello"))
                .andExpect(content().string("hello mockCherrue"));

        assertThat(outputCapture.toString())
                .contains("holoman")
                .contains("skip");
    }
}
```

## 6. Spring-Boot-Devtools
ê°œë°œì— ìœ ìš©í•œ ê¸°ëŠ¥ ëª¨ìŒ

6-1. ì‚¬ìš© ë°©ë²•

```java
// pom.xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <version>2.2.0.RELEASE</version>
</dependency>
```

6-2. ì˜ì¡´ì„± ì¶”ê°€ ì‹œ ì¶”ê°€ë˜ëŠ” ê¸°ëŠ¥

1. ìºì‹œë“¤ì„ êº¼ì¤Œ
2. restart : ì½”ë“œë¥¼ ê³ ì¹˜ê³  **ë¹Œë“œë¥¼ í•˜ë©´** ì„œë²„ë¥¼ ì¬ì‹œì‘í•´ì£¼ëŠ”ë°, í†°ìº£ì„ ê»ë‹¤í‚¤ëŠ” ê±°ë³´ë‹¤ í›¨ì”¬ ë¹ ë¦„ <br/>
BaseClassLoader : ì˜ ì•ˆ ë°”ë€ŒëŠ” í´ë˜ìŠ¤ ë‹´ë‹¹ ë¡œë” <br/>
restart ClassLoader : ìš°ë¦¬ê°€ ìì£¼ ìˆ˜ì •í•˜ëŠ” í´ë˜ìŠ¤ ë‹´ë‹¹ ë¡œë” <br/>
3. live reload : restart ë˜ë©´ ì›¹ë¸Œë¼ìš°ì €ë„ ìƒˆë¡œê³ ì¹¨ í•´ì¤Œ. í”ŒëŸ¬ê·¸ì¸ì´ ì„¤ì¹˜ë˜ì–´ì•¼ í•¨
4. ./spring-boot-devtools.properties : ìš°ì„  ìˆœìœ„ê°€ ì œì¼ ë†’ì€ í”„ë¡œí¼í‹°

ì‚¬ì‹¤ ë”±íˆ ìœ ìš©í•œ ê¸°ëŠ¥ì€ ì•„ë‹ˆë‹¤..!