---
layout: single
title: \[Github\] ê¹ƒí—™ í”„ë¡œí•„ ê¾¸ë¯¸ê¸° - ê¹ƒí—™ ë¸”ë¡œê·¸ ìµœì‹ ê¸€ ì¶”ê°€
date: 2021-11-29 02:01:00 +0900
categories: github github_blog github_profile
---

ê¹ƒí—™ í”„ë¡œí•„ì— ë¸”ë¡œê·¸ ìµœì‹ ê¸€ì„ ë„£ìœ¼ë ¤ê³  í•œë‹¤.

tistory, velog ë“± ì™¸ë¶€ í”Œë«í¼ ìë£ŒëŠ” ë§ì€ë° ë¹„í•´, ê¹ƒí—™ ë¸”ë¡œê·¸ ìë£ŒëŠ” ëª» ì°¾ì•„ ë§Œë“¤ì–´ ë³´ê¸°ë¡œ í–ˆë‹¤.

ê²°ê³¼ëŠ” [ê¹ƒí—™ í”„ë¡œí•„](https://github.com/cherrue) í™•ì¸

## ì‘ì—… ë°©ë²•

ê¸€ ëª©ë¡ë§Œ ë§Œë“¤ì–´ì„œ github actionì—ì„œ README.mdë¥¼ ê³ ì¹˜ë„ë¡ ë§Œë“¤ë©´ ëœë‹¤.

> github action : github CI/CD ê¸°ëŠ¥ìœ¼ë¡œ workflowë¥¼ ìë™í™” í•˜ëŠ” ê¸°ëŠ¥. ì½”ë“œ ë¹Œë“œ/í…ŒìŠ¤íŠ¸/ë°°í¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

ì‘ì—…ìˆœì„œ

1. ë¸”ë¡œê·¸ ìµœì‹ ê¸€ì˜ ì œëª©ê³¼ urlì„ íŒŒì‹±í•œë‹¤.
2. íŒŒì‹±í•œ ë°ì´í„°ë¥¼ README.mdì— ì¶”ê°€í•œë‹¤.
3. 1-2ë¥¼ ì‹¤í–‰í•˜ëŠ” ì½”ë“œë¥¼ github actionì— ë¶™ì—¬ì¤€ë‹¤.

## ìƒì„¸ ì‘ì—…

### 1. ë¸”ë¡œê·¸ ìµœì‹ ê¸€ íŒŒì‹±

##### í™˜ê²½

| í™˜ê²½     | ë²„ì „   |
| -------- | ------ |
| python   | 3.8    |
| requests | 2.25.1 |
| bs4      | 4.6.0  |
| pytz     | 2020.5 |

* ëª¨ë‘ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì‚¬ìš©í•´ë„ ìƒê´€ì—†ë‹¤. ìµœì†Œí•œ ìœ„ì˜ ë²„ì „ì´ë¼ë©´ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•Šë”ë¼.

##### 1-1. html ë°›ì•„ì˜¤ê¸°

[ë‚´ ë¸”ë¡œê·¸](https://cherrue.github.io/)ëŠ” ë©”ì¸ í™”ë©´ì— ìµœì‹ ê¸€ 5ê°œê°€ í‘œì¶œë˜ê¸° ë•Œë¬¸ì— ë©”ì¸ í™”ë©´ì„ ê°€ì ¸ì˜¤ë©´ ëœë‹¤.

```python
import requests
from bs4 import BeautifulSoup

blog_url = "https://cherrue.github.io"
my_headers = {'Content-Type': 'application/json; charset=utf-8'}
my_timeout = 5
res = requests.get(blog_url, headers=my_headers, timeout=my_timeout)
soup = BeautifulSoup(res.text, "html.parser")

soup.prettify()
```

**ì‹¤í–‰ ê²°ê³¼**

```html
<!DOCTYPE doctype html>

<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html class="no-js" lang="ko">
<head>
<meta charset="utf-8"/>
<!-- begin _includes/seo.html --><title>ì²´ë¥´ì—ì˜ ê°œë°œ ë¸”ë¡œê·¸</title>
(ì´í•˜ ìƒëµ)
```



##### 1-2. ì›í•˜ëŠ” ë°ì´í„° ê°€ì ¸ì™€ì„œ markdownìœ¼ë¡œ ë§Œë“¤ê¸°

![html_tag](/assets/images/2021-11-29/html_tag.png)

í¬ë¡¬ ê°œë°œìë„êµ¬ì—ì„œ ë™ê·¸ë¼ë¯¸ ì¹œ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì›í•˜ëŠ” ë‚´ìš©ì„ í´ë¦­í•˜ë©´, ë„¤ëª¨ë°•ìŠ¤ ì²˜ëŸ¼ í™•ì¥ë˜ì–´ ë³´ì¸ë‹¤.

ìš°ë¦¬ê°€ ê°€ì ¸ì˜¬ ê²ƒì€ article í•˜ìœ„ì˜ a íƒœê·¸ë“¤ì„ ê°€ì ¸ì˜¤ë©´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```python
import datetime

articles = soup.select('article')
articles_data = [(article.select_one('a').get_text(), article.select_one('a').get("href"))
                     for article in articles]
write_text = ""
for post in articles_data:
    write_text += f"- [{post[0]}]({blog_url}{post[1]}) <br>\n"
write_text += "Updated at " + datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")

print(write_text)
```

beautifulsoup4 ì˜ select í•¨ìˆ˜ì— **css ì„ íƒì**ë¥¼ ë„£ì–´ì£¼ë©´ ì¼ì¹˜í•˜ëŠ” íƒœê·¸ë“¤ì„ listë¡œ ê°€ì ¸ì˜¨ë‹¤. select_oneì€ ì²«ë²ˆì§¸ë§Œ ê°€ì ¸ì˜¨ë‹¤.

**ì‹¤í–‰ ê²°ê³¼**

```markdown
- [[ê°•ì˜ìš”ì•½] MS Learn - Azure Database ë° ë¶„ì„ ì„œë¹„ìŠ¤ ì‚´í´ë³´ê¸°\n](https://cherrue.github.io/azure/azure_fundamentals/Azure-Database) <br>\n- [[ê°•ì˜ìš”ì•½] MS Learn - Azure Storage ì„œë¹„ìŠ¤ ì‚´í´ë³´ê¸°\n](https://cherrue.github.io/azure/azure_fundamentals/Azure-Storage) (ì´í•˜ìƒëµ)
```



##### 1-3. README.mdì— ë°ì´í„° ì‘ì„±

markdown ê´€ë ¨ íŒŒì´ì¬ ëª¨ë“ˆë„ ìˆì§€ë§Œ, êµ³ì´ ì“¸ í•„ìš”ì—†ë‹¤. python ë‚´ì¥ íŒŒì¼ ì…ì¶œë ¥ìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.

README.mdë¥¼ ì ê¹ ë³´ì.

```markdown
### ğŸ“ Recent Blog Posts  
<!-- BLOG-POST-LIST:START -->  
<!-- BLOG-POST-LIST:END -->  
<br/>  
```

ì´ STARTì™€ END ì£¼ì„ ì‚¬ì´ì— ë°ì´í„°ë¥¼ ì‘ì„±í•˜ë©´ ë˜ê² ë‹¤.

```python
with open(file_url, mode="r+", encoding="utf-8") as f:
    data = f.readlines()
    f.seek(0)

    erase_flag = False
    for line in data:
        if "<!-- BLOG-POST-LIST:START -->" in line:
            erase_flag = True
            f.write(line)
            f.write(write_text)
        elif "<!-- BLOG-POST-LIST:END -->" in line:
            erase_flag = False
        if not erase_flag:
            f.write(line)
    f.truncate()
```

í•œ ì¤„ í•œ ì¤„ ê°€ì ¸ì™€ì„œ START ì£¼ì„ì„ ë§Œë‚˜ë©´ ë§Œë“¤ì–´ë‘” markdownì„ ì‚½ì…í•˜ê³ 

ENDë¥¼ ë§Œë‚  ë•Œ ê¹Œì§€ì˜ lineì„ ë¬´ì‹œí•œë‹¤.

----

### 2. Github action ì¶”ê°€

![github_action](/assets/images/2021-11-29/github_action.png)

github action > Publish Python Package ë¥¼ ì„ íƒí•˜ì—¬ yamlíŒŒì¼ì„ ë§Œë“¤ì.

onì— ë°œìƒí•˜ëŠ” íŠ¸ë¦¬ê±°ë¥¼, jobsì— ì›í•˜ëŠ” ì‘ì—…ì„ ë‚˜ì—´í•´ì£¼ë©´ ëœë‹¤. **yamlì€ ë„ì–´ì“°ê¸°ì— ë¯¼ê°í•˜ë‹ˆ ì£¼ì˜**

```yaml
name: Update README.md

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: "0 0 */1 * *"

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install build
        pip install bs4
        pip install requests
        pip install pytz
    - name: Update README.md
      run: |
        python main.py
    - name: Commit README.md
      run: |
        git pull
        git add .
        git diff
        git config --local user.email "action@gihtub.com"
        git config --local user.name "GitHub Action"
        git commit -m "[Auto Update] Update recent blog posts to README.md"
        git push
```

## ê²°ê³¼

push/pull requestê°€ ë°œìƒí•˜ê±°ë‚˜ crontabì— ì„¤ì •í•œ ì‹œê°„ì´ ë˜ë©´ actionì´ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.

**ì‹¤í–‰ ë¡œê·¸ í™”ë©´**

![github_action_log](/assets/images/2021-11-29/github_action_log.png)

ì‹¤íŒ¨í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ë©”ì¼ë„ ë³´ë‚´ì¤€ë‹¤. (ë¸”ë¡œê·¸ ìµœì‹ ê¸€ ëª©ë¡ì´ ì•ˆ ë°”ë€Œì–´ commit í•  ì‚¬í•­ì´ ì—†ì–´ë„ ë©”ì¼ì´ ì˜¨ë‹¤.)

![fail_mail](/assets/images/2021-11-29/fail_mail.png)

ìµœì¢… ì†ŒìŠ¤ì½”ë“œëŠ” [https://github.com/Cherrue/Cherrue](https://github.com/Cherrue/Cherrue) ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

<details>
<summary>main.py</summary>
  <div markdown="1">


```python
import requests
from bs4 import BeautifulSoup
import datetime
import pytz

timeout = 5
blog_url = "https://cherrue.github.io"
dest_file_url = "README.md"
KST = pytz.timezone('Asia/Seoul')


def getTitleAndLinkFromResponse(res):
    soup = BeautifulSoup(res.text, "html.parser")
    articles = soup.select('article')
    articles_data = [(article.select_one('a').get_text(), article.select_one('a').get("href"))
                     for article in articles]
    return articles_data


def getPostsTop5(_url: str, _timeout):
    MAX_RETRY = 5
    my_headers = {'Content-Type': 'application/json; charset=utf-8'}
    retries = 0
    while True:
        res = requests.get(_url, headers=my_headers, timeout=_timeout)
        retries = retries + 1

        # like do while
        if res is not None and res.status_code == 200:
            break

        # prevent endless loop
        if retries > MAX_RETRY:
            return [("posts parse failed", "about:blank/")]
    return getTitleAndLinkFromResponse(res)


def getMarkdownTextFromPosts(_posts: list):
    result = ""
    for post in _posts:
        result += f"- [{post[0]}]({blog_url}{post[1]}) <br>\n"
    result += "Updated at " + \
        datetime.datetime.now(KST).strftime(
            "%Y-%m-%d %H:%M:%S") + " (+09:00)<br>\n"
    return result


def writeNewPostListToFile(file_url: str, write_text: str):
    with open(file_url, mode="r+", encoding="utf-8") as f:
        data = f.readlines()
        f.seek(0)

        erase_flag = False
        for line in data:
            if "<!-- BLOG-POST-LIST:START -->" in line:
                erase_flag = True
                f.write(line)
                f.write(write_text)
                continue  # don't erase START line
            if "<!-- BLOG-POST-LIST:END -->" in line:
                erase_flag = False
            if not erase_flag:
                f.write(line)
        f.truncate()


posts = getPostsTop5(blog_url, timeout)
markdown_text = getMarkdownTextFromPosts(posts)
writeNewPostListToFile(dest_file_url, markdown_text)

```
</div>

</details>

<details>
  <summary>.github/workflows/update-recent-posts.yml</summary>
  <div markdown="1">

```yaml
# This workflow will upload a Python Package using Twine when a release is created
# For more information see: https://help.github.com/en/actions/language-and-framework-guides/using-python-with-github-actions#publishing-to-package-registries

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Update README.md

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: "0 0 */1 * *"
#  release:
#    types: [published]

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install build
        pip install bs4
        pip install requests
        pip install pytz
    - name: Update README.md
      run: |
        python main.py
    - name: Commit README.md
      run: |
        git pull
        git add .
        git diff
        git config --local user.email "action@gihtub.com"
        git config --local user.name "GitHub Action"
        git commit -m "[Auto Update] Update recent blog posts to README.md"
        git push
#     - name: Build package
#       run: python -m build
#     - name: Publish package
#       uses: pypa/gh-action-pypi-publish@27b31702a0e7fc50959f5ad993c78deac1bdfc29
#       with:
#         user: __token__
#         password: ${{ secrets.PYPI_API_TOKEN }}
```

</div>

</details>