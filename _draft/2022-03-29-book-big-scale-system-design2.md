# 7장. 분산 시스템을 위한 유일 ID 생성기 설계

## 1. 유일 ID 생성 방법

### 1-1. 다중 마스터 복제

id를 auto increase 하되, 1이 아닌 서버의 대수 만큼씩 증가

장점

- ID 유일성 보장
- 서버의 대수를 늘리면 초당 생산 가능 ID 수를 늘릴 수 있음

단점

- 여러 데이터 센터에 걸쳐 규모를 늘리기 어렵다
- ID가 시간과 비례함을 보장할 수 없다
- 서버를 추가하거나 삭제할 때 잘 동작하기 어렵다

### 1-2. UUID

각 서버의 ID 생성기가 128비트 랜덤 문자열 부여

장점

- 서버 사이의 조율이 필요 없어 동기화 이슈가 없음
- 각 서버가 각자 ID 생성기를 갖기 때문에 규모 확장이 쉽다

단점

- 길이가 길다.
- ID가 시간과 비례하지 않는다
- 숫자가 아닌 문자열이다

### 1-3. 티켓 서버

auto increase로 ID를 발행하는 티켓 서버를 구축하고 DB는 이 티켓서버를 통해 ID를 받는다

장점

- 요구사항을 만족시키는 ID를 만들기 쉽다
- 구현이 쉽다

단점

- 티켓서버가 SPOF 가 된다.
- 티켓 서버 이중화 시 동기화 이슈가 있다.

### 1-4. 트위터 스노플레이크

ID를 비트 단위로 의미를 부여한다.

buffer + timestamp + data center ID + server ID + 일련번호

장점

- 요구사항을 만족시키는 ID를 만들기 쉽다

단점

- 요구사항을 제대로 식별해야 한다
- ID의 형태를 변경하기 어렵다.

## 2. 단계별 설계

### 1단계 문제 이해 및 설계 범위 확정

- 유일성
- 자료형
- 크기
- 정렬
- 단위 시간 당 생산 가능 개수

### 2단계 개략적인 설계안 제시 및 동의 구하기

- ID 생성 기법 선택

### 3단계 상세 설계

- 선택한 기법의 단위 시간당 ID 생산량 계산
- 해당 ID로 저장 가능한 최대 데이터 수
- 시간 값이 들어간다면, 저장 가능한 기간

### 4단계 마무리

추가 논의 사항

- 시계 동기화 : NTP 서버 구축
- 스노플레이크라면) 각 section 의 크기 최적화
- 고가용성 : 장애 대응 방법
